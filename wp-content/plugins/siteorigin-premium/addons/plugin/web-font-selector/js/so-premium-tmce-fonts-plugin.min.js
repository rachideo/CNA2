var SOPremiumFontSelectorPlugin=function(i,t){var a,o=jQuery,e="so_premium_font_format",r=soPremiumFonts.font_modules;function f(){new SOPremiumFontsImporter(i.contentDocument).importFonts()}function m(){a.attr("data-placeholder",soPremiumFonts.placeholder_text),a.webfontselector({modules:r,useVariants:!0,useSubsets:!1,showInherit:!1});var t,n=a.siblings(".chosen-container").find(".chosen-search input");n.on("mouseup",function(){t||(t=setTimeout(function(){n.focus(),t=null},100))}),a.on("font_change",function(t,n,o){n&&n.hasOwnProperty("font")&&n.font?i.execCommand("soPremiumApplyFont",e,n):i.execCommand("soPremiumRemoveFont",e)})}i.on("init",function(){i.formatter.register(e,{inline:"span",classes:"so-premium-web-font",attributes:{"data-web-font-module":"%fontModule","data-font-info":"%fontInfo"},styles:{"font-family":"%fontFamily","font-weight":"%fontWeight"},remove:"all"}),f()}),i.on("NodeChange",function(t){if(i.formatter&&a){var n=t.element,o="",e="";if(n.hasAttribute("data-font-info")){var r=JSON.parse(n.getAttribute("data-font-info"));o=r.font,e=r.hasOwnProperty("variant")?r.variant:""}a.webfontselector("update",o,e)}}),i.addCommand("soPremiumApplyFont",function(t,n){var o=n.font?"'"+n.font+"'":"";o+=n.category?", "+n.category:"";var e="regular";if(n.variant){var r=n.variant.match(/(\d*)(\w*)/);1<r.length&&r[1]&&(e=r[1])}i.formatter.apply(t,{fontFamily:o,fontWeight:e,fontInfo:JSON.stringify(n),fontModule:n.module}),f()}),i.addCommand("soPremiumRemoveFont",function(t){i.formatter.remove(t,{fontFamily:null,fontModule:null},null,!0)}),i.addButton("so-premium-font-selector",{type:"selectbox",icon:!1,onPostRender:function(t){if((a=o(t.control.$el)).is(":visible"))m();else var n=setInterval(function(){a.is(":visible")&&(m(),clearInterval(n),n=null)},500)}})};(0,window.jQuery)(document).ready(function(){tinymce.PluginManager.add("so-premium-font-selector",function(t,n){new SOPremiumFontSelectorPlugin(t,n)})});