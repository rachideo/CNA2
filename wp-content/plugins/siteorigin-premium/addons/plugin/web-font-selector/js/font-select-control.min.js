jQuery(function(e){var t=window.socss;t.view.properties.controllers.font_select=t.view.propertyController.extend({template:_.template('<div class="font-wrapper"><select class="socss-property-controller-input"></select></div>'),onChange:function(){},render:function(){this.$el.append(e(this.template({}))),this.field=this.$el.find("select"),this.field.webfontselector({modules:this.args.modules,width:"100%"}),this.field.on("font_change",function(e,t,s){this.updateRule(t,s)}.bind(this))},setValue:function(e,t){t=_.extend({silent:!1},t),this.field.webfontselector("update",e),t.silent||this.trigger("set_value",e)},updateRule:function(e,t){var s,i,r,a=e.font?"'"+e.font+"'":"";if(a+=e.category?", "+e.category:"",this.propertiesView.setRuleValue(this.args.property,a),e.webfont){s=this.args.modules[e.module],i=this.propertiesView.findImport(s.base_url);var o=e.font.replace(new RegExp("\\s","g"),"+");i?(-1===(r=this.importRuleToFontsInfo(i)).families.indexOf(o)&&r.families.push(o),"400"!==e.variant&&"regular"!==e.variant&&-1===r.variants.indexOf(e.variant)&&r.variants.push(e.variant),"latin"!==e.subset&&-1===r.subsets.indexOf(e.subset)&&r.subsets.push(e.subset),r.base_url=s.base_url,this.propertiesView.updateImport(s.base_url,this.fontsInfoToImportRule(r))):(r={base_url:s.base_url,families:[o]},"400"!==e.variant&&"regular"!==e.variant&&(r.variants=[e.variant]),"latin"!=e.subset&&(r.subsets=[e.subset]),this.propertiesView.addImport(this.fontsInfoToImportRule(r)))}if(t&&t.webfont){s=this.args.modules[t.module],i=this.propertiesView.findImport(s.base_url),r=this.importRuleToFontsInfo(i);for(var n=[],l=this.propertiesView.parsed.stylesheet.rules,u=0;u<l.length;u++){var p=l[u];if(p.declarations)for(var f=0;f<p.declarations.length;f++){var m=p.declarations[f];if("font-family"===m.property&&m.value){var h=m.value.match(/\'([^\']+)\'/)[1];-1==n.indexOf(h)&&n.push(h.replace(new RegExp("\\s","g"),"+"))}}}for(var d=[],v=0;v<r.families.length;v++){h=r.families[v];-1==n.indexOf(h)&&d.push(h)}for(var c=0;c<d.length;c++)r.families.splice(r.families.indexOf(d[c]),1);r.base_url=s.base_url,0<r.families.length?this.propertiesView.updateImport(s.base_url,this.fontsInfoToImportRule(r)):this.propertiesView.removeImport(s.base_url)}},importRuleToFontsInfo:function(e){for(var t,s={families:[],variants:[],subsets:[]},i=/[\?|\&]([^=]+)\=([^&\s\)\;]+)/g;null!==(t=i.exec(e.import));)if("family"===t[1]){var r=t[2].split(":");s.families=r[0].split("|"),1<r.length&&(s.variants=r[1].split(","))}else"subset"===t[1]&&(s.subsets=t[2].split(","));return s},fontsInfoToImportRule:function(e){var t={type:"import"},s="url("+e.base_url+"?family="+e.families.join("|");return _.isEmpty(e.variants)||(s+=":"+e.variants.join(",")),_.isEmpty(e.subsets)||(s+="&subset="+e.subsets.join(",")),s+=")",t.import=s,t}}),window.socss.mainEditor.visualProperties.render()});